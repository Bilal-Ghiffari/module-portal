import{c6 as M,r as p,j as t,L as W,aG as J,I as K,B as C,co as q,cp as G,cq as X,cr as Q,t as Y,c7 as g,w as Z,cs as ee,ct as E,b as se,c as D,b8 as f,cu as te,bU as ne}from"./index-cb7bfd5e.js";import{C as oe}from"./Card-97ca64ca.js";import{C as le}from"./CardContent-50d99df2.js";const ae={apiWilayah:"/master/wilayah",apiNegara:"/master/negara",apiPekerjaan:"/master/pekerjaan",apiAgama:"/master/agama",apiStatusKawin:"/master/status-kawin"};var z;(z=JSON.parse(localStorage.getItem("userSession")))!=null&&z.token;const re=s=>{if(!s||typeof s!="object")return"";const e=Object.keys(s).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(s[n])}`).join("&");return e?`?${e}`:""},xe=s=>{const e=re({tipe:"kotakab",id:s});return M(`${ae.apiWilayah}${e}`)},ye=({formik:s,name:e,label:n,acceptedFileTypes:o=["application/pdf"],maxFileSizeMB:d=1,required:P=!1,uploadFnc:I,delFnc:pe,documentUrl:x,...T})=>{const y=p.useRef(null),[m,c]=p.useState(null),[r,k]=p.useState(!1),[j,h]=p.useState(null),[N,b]=p.useState(null);p.useEffect(()=>{const l=s.values[e];x?(b(x),h({url:x,uploaded:!0}),c(null)):l instanceof File?(c(l.name),b(null),h(null)):(c(null),b(null),h(null))},[s.values[e],x,e]);const $=l=>{const a=l.currentTarget.files[0];if(s.setFieldTouched(e,!0),a){const i=d*1024*1024;if(console.log("File validation:",{fileName:a.name,fileType:a.type,fileSize:a.size,maxSizeBytes:i,acceptedTypes:o}),!o.includes(a.type)){const u=`Tipe file tidak valid. Harap unggah ${o.map(O=>O.split("/")[1].toUpperCase()).join(", ")}.`;console.log("❌ File type validation failed:",u),s.setFieldError(e,u),s.setFieldValue(e,null),c(null),g(u);return}if(a.size>i){const u=`Ukuran file tidak boleh lebih dari ${d}MB.`;console.log("❌ File size validation failed:",u),s.setFieldError(e,u),s.setFieldValue(e,null),c(null),g(u);return}console.log("✅ File validation passed, setting file to formik"),s.setFieldValue(e,a),c(a.name),s.setFieldError(e,void 0),console.log("File set successfully")}else console.log("No file selected, clearing state"),s.setFieldValue(e,null),c(null),s.setFieldError(e,void 0)},A=()=>{console.log(`=== Reset File State [${e}] ===`),c(null),h(null),b(null),s.setFieldValue(e,null),s.setFieldError(e,void 0),y.current&&(y.current.value="")},B=async l=>{l.stopPropagation(),console.log(`=== Handle Upload [${e}] ===`),console.log("currentFile:",m),console.log("formik.values[name]:",s.values[e]);const a=s.values[e];if(!a||!(a instanceof File)){console.log("❌ No valid file to upload"),g("Tidak ada file yang valid untuk diunggah");return}if(!I){console.log("❌ No upload function provided"),g("Fungsi upload tidak tersedia");return}try{k(!0),console.log("🚀 Starting upload for file:",a.name);const i=await I(a,e);if(console.log("✅ Upload response:",i),i)h(i),c(null),s.setFieldValue(e,i),s.setFieldError(e,void 0),Z("File berhasil diunggah"),console.log("✅ Upload completed successfully");else throw new Error("Invalid response format")}catch(i){console.error("❌ Upload error:",i),g(i.message||"Gagal mengunggah file")}finally{k(!1)}},V=l=>{if(l.stopPropagation(),!N){g("Dokumen tidak tersedia");return}window.open(N,"_blank")},U=()=>{var l;r||(l=y.current)==null||l.click()},F=!!m,v=!!j,_=F&&!r,R=!!N,S=s.values[e];console.log("HAS HAVE FILE",S);const w=s.touched[e]&&!!s.errors[e],H=()=>(console.log("HAS Upload File",v),console.log("HAS Selected file",F),console.log("Uploaded Data",j),console.log("Current file",m),v&&j.original_name?`${j.original_name}`:F?m:S?`${S.original_name}`:"Unggah dokumen dengan klik untuk memilih file"),L=()=>t.jsxs("div",{children:[t.jsx(ee,{className:"spin"})," Uploading"]});return t.jsxs("div",{className:"mb-3",children:[t.jsxs(W,{style:{fontSize:"12px",fontWeight:500},htmlFor:e,children:[n," ",P&&t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("div",{className:"d-flex align-items-center",children:t.jsxs(J,{sx:{border:w?"1px solid #dc3545":"1px solid #E7E7E7",borderRadius:2,width:"100%",backgroundColor:v?"#f8f9fa":"white"},children:[t.jsx(K,{id:e,name:e,type:"file",className:"form-control",onChange:$,onBlur:()=>s.setFieldTouched(e,!0),innerRef:y,style:{display:"none"},invalid:w,accept:o.join(","),disabled:S,...T}),t.jsxs("div",{onClick:U,role:"button",tabIndex:0,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),U())},style:{minWidth:"100%",cursor:r?"not-allowed":"pointer",opacity:r?.7:1},className:"d-flex align-items-center justify-content-between p-2",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx(C,{style:{backgroundColor:"#041662",pointerEvents:"none",border:"none"},className:"me-2 py-1 px-2",size:"sm",children:t.jsx(q,{size:16})}),t.jsx("span",{style:{color:"#041662",fontSize:"12px",lineHeight:"22px",fontWeight:"500",opacity:r?.7:1},children:r?L():H()})]}),t.jsxs("div",{className:"d-flex align-items-center",children:[R&&t.jsx(C,{style:{backgroundColor:"transparent",border:"none",transition:" 0.2s"},className:"me-1 py-1 px-2",size:"sm",onClick:V,disabled:r,children:t.jsx(G,{size:14,color:"#041662"})}),_&&t.jsx(C,{style:{backgroundColor:"#28a745",border:"none"},className:"me-1 py-1 px-2",size:"sm",onClick:B,disabled:r,title:"Upload file",children:r?"...":t.jsx(X,{size:16})}),F&&!v&&!r&&t.jsx(C,{style:{backgroundColor:"#6c757d",border:"none"},className:"py-1 px-2",size:"sm",onClick:l=>{l.stopPropagation(),A()},disabled:r,title:"Batal pilih file",children:t.jsx(Q,{size:16})})]})]})]})}),t.jsxs("span",{style:{fontSize:"10px",fontWeight:400,lineHeight:"16px",color:"#6D6D6D"},children:["* File berformat"," ",o.map(l=>l.split("/")[1].toUpperCase()).join(" atau ")," ","dan tidak lebih dari ",d,"MB"]}),w&&t.jsx(Y,{type:"invalid",className:"d-block",style:{fontSize:"10px"},children:s.errors[e]})]})},me=s=>{try{const e=`id_permohonan_${s}`,n=localStorage.getItem(e);return n?JSON.parse(n):null}catch(e){return console.error("Error retrieving currentPermohonanId from localStorage:",e),null}},je=(s,e)=>{try{const n=`id_permohonan_${s}`;localStorage.setItem(n,JSON.stringify(e))}catch(n){console.error("Error saving currentPermohonanId to localStorage:",n)}},be=s=>{try{const e=`id_permohonan_${s}`;localStorage.removeItem(e)}catch(e){console.error("Error removing currentPermohonanId from localStorage:",e)}};async function Fe(s,e={},n={}){return await E.post(s,e,{headers:{"Content-Type":"application/json",...n.headers},...n}).then(o=>o.data).catch(o=>{throw console.error("POST JSON Error:",o),o})}async function ve(s,e={},n={}){return await E.patch(s,e,{headers:{"Content-Type":"application/json",...n.headers},...n}).then(o=>o.data).catch(o=>{throw console.error("PATCH JSON Error:",o),o})}async function Se(s,e,n={}){return E.post(s,e,{headers:{"Content-Type":"multipart/form-data",...n}}).then(o=>o.data).catch(o=>{throw console.error("UPLOAD File Error:",o),o})}const Ce=(s,e)=>s.filter(n=>e.includes(n.id)),Ne=(s,e)=>s.findIndex(n=>n.id===(e==null?void 0:e.id)),ie=s=>s!=null&&s!==""&&!(Array.isArray(s)&&s.length===0)&&!(typeof s=="object"&&s!==null&&Object.keys(s).length===0),we=(s,e)=>e.reduce((n,o)=>{const d=s[o];return ie(d)&&(n[o]=d),n},{}),Ee=(s,e)=>t.jsxs(se,{className:"mb-2",children:[t.jsx(D,{xs:"4",md:"4",lg:"5",children:t.jsx(f,{variant:"body2",fontWeight:"bold",children:s})}),t.jsx(D,{xs:"8",md:"8",lg:"7",children:t.jsxs(f,{variant:"body2",children:[": ",e||"-"]})})]}),ce=()=>t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:t.jsx("i",{className:"bx bx-loader-circle spin fs-1"})}),Ie=ce,de=`
  @keyframes popIn {
    0% {
      transform: scale(0);
      opacity: 0;
    }
    60% {
      transform: scale(1.2);
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  .verified-icon {
    animation: popIn 0.6s ease-out forwards;
  }
`,ue=({title:s,subTitle:e,description:n,redirectUrl:o})=>{const d=()=>{o&&(window.location.href=o,window.location.reload())};return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:de}),t.jsx(oe,{sx:{maxWidth:628,height:351},className:"d-flex justify-content-center align-items-center",children:t.jsxs(le,{className:"d-flex flex-column justify-content-center gap-3",children:[t.jsx(f,{className:"text-center",children:t.jsx(te,{size:150,color:"green",className:"verified-icon"})}),t.jsx(f,{gutterBottom:!0,variant:"h5",component:"div",className:"d-flex justify-content-center align-items-start",sx:{fontFamily:"Poppins"},children:s}),t.jsx(f,{variant:"body2",sx:{color:"text.secondary",textAlign:"center",fontFamily:"Poppins"},children:e}),t.jsx("div",{className:"d-flex justify-content-end align-items-end text-end",children:t.jsx(ne,{text:"Keluar",onClick:d})})]})})]})},ke=({title:s,subTitle:e,redirectUrl:n})=>t.jsx("div",{className:"bg-white page-content w-full d-flex justify-content-center align-items-center flex-column gap-2",style:{height:"80dvh"},children:t.jsx(ue,{title:s,subTitle:e,redirectUrl:n})});export{ye as F,Ie as L,Ee as R,ke as S,xe as a,Fe as b,Se as c,we as d,Ce as e,Ne as f,me as g,ve as p,be as r,je as s};
