import{r as i,u as L,h as W,a4 as q,Y as D,i as F,a2 as I,a as V,j as a,C as G,b as S,c as j,B as _,L as P,Z as $,_ as Q,I as J,aw as Y,ax as Z,ay as v,az as k,aA as X,a1 as C,$ as ee,aB as ae,aC as se,aD as le,aE as oe,w as te,x as R,T as de}from"./index-59030646.js";import{S as ce}from"./TableSortMui-335fb556.js";import{B as ie}from"./Breadcrumb-49172a3f.js";const ne=(t,c,n)=>[...t].sort((m,p)=>{const g=typeof m[c]=="string"?m[c].replace(/\*/g,""):m[c]||0,r=typeof p[c]=="string"?p[c].replace(/\*/g,""):p[c]||0,o=isNaN(g)?g:parseFloat(g),d=isNaN(r)?r:parseFloat(r);return typeof o=="string"&&typeof d=="string"?n==="asc"?o.localeCompare(d):d.localeCompare(o):n==="asc"?o-d:d-o}),M=[{id:"code",name:"Kode Role",width:80,align:"center"},{id:"title",name:"Nama Role",width:180,align:"center"},{id:"module",name:"Akses Modul",width:280}],re=[{module:"Advokasi Keperdataan",module_code:"40"},{module:"AHU Advokat Asing",module_code:"30"},{module:"AHU Badan Usaha",module_code:"29"},{module:"AHU Daktiloskopi",module_code:"28"},{module:"AHU Fidusia",module_code:"27"},{module:"AHU Grasi",module_code:"31"},{module:"AHU Kewarganegaraan",module_code:"26"},{module:"AHU Koperasi",module_code:"25"},{module:"AHU Kurator",module_code:"24"},{module:"AHU Legalisasi - Apostille",module_code:"23"},{module:"AHU Notariat",module_code:"11"},{module:"AHU Partai Politik",module_code:"22"},{module:"AHU Pemilik Manfaat",module_code:"21"},{module:"AHU Perkumpulan",module_code:"16"},{module:"AHU Perseroan Perseorangan",module_code:"20"},{module:"AHU Perseroan Terbatas",module_code:"15"},{module:"AHU Pewarganegaraan",module_code:"19"},{module:"AHU PPNS",module_code:"18"},{module:"AHU SIMJA-OP",module_code:"17"},{module:"AHU Simpadhu",module_code:"12"},{module:"AHU Simpalnot",module_code:"32"},{module:"AHU Unduh Data",module_code:"13"},{module:"AHU Wasiat",module_code:"14"},{module:"Aplikasi BO",module_code:"41"},{module:"e-Harapan",module_code:"34"},{module:"e-Office BHP",module_code:"38"},{module:"E-Pasti",module_code:"33"},{module:"e-Smart",module_code:"39"},{module:"Monitoring Kanwil",module_code:"36"},{module:"Portal Ditjen AHU",module_code:"37"},{module:"Simpatik",module_code:"35"}],T=[{link:"/user-management/tabel-user",label:"User Management"},{link:"#",label:"Role"}],ge=()=>{var y;const[t,c]=i.useState({page:"1",limit:"10"}),[n,m]=i.useState({}),[p,g]=i.useState({}),r=L(),[o,d]=i.useState({}),f=new de,{list_dropdown_roles:u,list_dropdown_modules:me}=W(e=>e.Usman);i.useEffect(()=>{if(u!=null&&u.data){const e=Array.from(u==null?void 0:u.data.reduce((s,l)=>{if(s.has(l.code)){const x=s.get(l.code);x.module=Array.from(new Set([...x.module.split(", "),l.module])).join(", ")}else s.set(l.code,{...l,module:l.module});return s},new Map).values());console.log("uniqueData ",e),g(e),m({total_count:e.length,data:e.slice(0,10)})}},[u]),i.useEffect(()=>{r(q()),r(D()),r(F(T))},[]),i.useEffect(()=>{var e;if(o.click_search){const s={page:1,limit:10,r_modules_code:((e=o.module)==null?void 0:e.code)||"",search:o.search||""};c(s);const l={...s};delete l.page,delete l.limit,d({...o,click_search:!1}),r(D(I(l)))}},[o.click_search]);const E=e=>{const s={...t,page:e};c(s),m({...n,data:p.slice((e-1)*+t.limit,e*+t.limit)})},[b,O]=i.useState({}),A=Object.keys(b)[0],w=Object.values(b)[0];i.useEffect(()=>{if(Object.keys(b).length){const e=ne(p||[],A,w);g(e),m({...n,data:e.slice((+t.page-1)*+t.limit,+t.page*+t.limit)})}},[b]);const K=e=>{const s=A===e&&w==="asc";O({[e]:s?"desc":"asc"})},U=V(),z=e=>{U(`/user-management/roles/d/${e}`)},B=async e=>{if(!await f.confirmationDelete())return;f.showLoading();const x=(await se({r_roles_code:e})).data.flatMap(h=>h.menu.map(N=>N.id));let H="";for(let h of x)try{await le({id:h})}catch(N){H=N}if(H)return f.customWarningMsg("Gagal Menghapus Hak Akses, Harap Dicoba Kembali");try{await oe({code:e}),te("Sukses Menghapus Data"),d({...o,click_search:!0})}catch(h){console.log("error",h),h.status==412?R({},"Role Tidak Dapat Dihapus Karena Sedang Digunakan"):R(h)}finally{f.close()}};return a.jsxs(G,{fluid:!0,className:"page-content",children:[a.jsx(ie,{content:T,title:"Role Management"}),a.jsx(S,{className:"mb-3",children:a.jsx(j,{md:12,children:a.jsx("div",{className:"w-100 text-end",children:a.jsx(_,{color:"success",className:"text-white",onClick:()=>U("/user-management/roles/create"),children:"Tambah Role"})})})}),a.jsxs("div",{className:"border rounded-4 bg-white p-3",children:[a.jsx("div",{className:"p-3 mb-3 rounded bg-secondary-subtle",children:a.jsxs(S,{children:[a.jsxs(j,{md:4,children:[a.jsx(P,{className:"mb-0",children:"Filter Modul"}),a.jsx($,{name:"module",isClearable:!0,placeholder:"Modul",getOptionValue:e=>e.module_code,getOptionLabel:e=>e.module,options:re,value:o.module||null,styles:Q,onChange:e=>{d(s=>({...s,module:e||null}))},className:"select2-selection"})]}),a.jsxs(j,{md:4,children:[a.jsx(P,{className:"mb-0",children:"Nama Role"}),a.jsx(J,{name:"cari",placeholder:"Nama Role",onChange:e=>d(s=>({...s,search:e.target.value})),value:o.search,className:"select2-selection"})]}),a.jsx(j,{md:4,className:"d-flex justify-content-end mt-3",children:a.jsx(_,{type:"button",color:"primary",className:"btn-md rounded px-4",onClick:()=>d({...o,click_search:!0}),children:"Cari"})})]})}),a.jsxs("div",{className:"table-wrapper",children:[a.jsx("div",{className:"w-100 overflow-x-scroll table-scroll",children:a.jsxs(Y,{className:"w-100",children:[a.jsx(Z,{className:"bg-primary",children:a.jsxs(v,{children:[a.jsx(k,{size:"small",sx:{minWidth:100,margin:0,padding:.5,fontSize:"0.8rem",backgroundColor:"#2A3042"},className:"text-white border border-secondary-subtle px-2",align:"center",children:"Aksi"}),M.map((e,s)=>a.jsx(ce,{item:e,orderBy:A,order:w,handleRequestSort:K},e+"_"+s))]})}),a.jsx(X,{children:(y=n.data)==null?void 0:y.map((e,s)=>a.jsxs(v,{sx:{backgroundColor:s%2===0?"#f3f3f3":"white",cursor:"pointer"},children:[a.jsx(k,{size:"small",sx:{minWidth:80,fontSize:"0.8rem"},align:"center",className:"py-2",style:{width:80},children:a.jsxs("div",{className:"d-flex column-gap-2",children:[a.jsx(C,{title:"Edit Data",placement:"top",children:a.jsx("div",{children:a.jsx(_,{onClick:()=>z(e.code),color:"success",className:"p-2 d-inline-flex",children:a.jsx("i",{className:"bx bxs-pencil fs-5 text-white"})})})}),a.jsx(C,{title:"Hapus Role",placement:"top",children:a.jsx("div",{children:a.jsx(_,{onClick:()=>B(e.code),color:"danger",className:"p-2 d-inline-flex",children:a.jsx("i",{className:"bx bx-trash fs-5 text-white"})})})})]})}),M.map((l,x)=>a.jsx(k,{size:"small",sx:{minWidth:l.width,fontSize:"0.8rem"},align:l.align||"left",className:"py-2",style:{width:l.width},children:l.align==="right"?ee(e[l.id]):e[l.id]},x))]},s))})]})}),a.jsx("div",{className:"scroll-indicator"})]}),a.jsx(ae,{pageNow:+t.page,totalPage:n.total_count/+t.limit||0+1,setPage:E,visibleRows:t.limit,perPage:t.limit,totalData:n.total_count||0})]})]})};export{ge as default};
