import{j as a,b as r,c as s,c0 as v,aG as k,bY as t,r as _,C as F,bU as y,g as W,a as M,A as R,T as z}from"./index-cb7bfd5e.js";import{b as H,c as I}from"./api-2be7e7e7.js";import{D as O,T as U,A as G}from"./TaskAltOutlined-13fc690d.js";const $=({formik:e})=>a.jsxs(r,{children:[a.jsxs(r,{children:[a.jsxs(s,{children:[a.jsx(v,{title:"Informasi Pribadi"}),a.jsxs(k,{className:"form-horizontal",children:[a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"nama_lengkap_pemohon",placeholder:"Tulis nama lengkap",title:"Nama Lengkap",readonly:!0})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"id_kewarganegaraan_asal_pemohon",title:"Kewarganegaraan Asal",readonly:!0,placeholder:"!"})})]}),a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"id_negara_lahir_pemohon",title:"Negara kelahiran",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"tgl_lahir_pemohon",title:"Tanggal Lahir",readonly:!0,placeholder:"!"})})]}),a.jsx(r,{children:a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"jenis_kelamin_pemohon",title:"Jenis Kelamin",readonly:!0,placeholder:"!"})})}),a.jsx(r,{children:a.jsx(t,{formik:e,name:"id_pekerjaan_pemohon",title:"Pekerjaan",readonly:!0,placeholder:"!"})})]})]}),a.jsxs(s,{children:[a.jsx(v,{title:"Informasi Pernikahan"}),a.jsx(k,{className:"form-horizontal",children:a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"status_kawin_pemohon",title:"Status Perkawinan",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"tgl_akta_kawin_pemohon",title:"Tanggal Pernikahan",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"no_akta_kawin_pemohon",title:"Nomor Buku Nikah / Akta Nikah",readonly:!0,placeholder:"!"})})]})})]})]}),a.jsx(r,{children:a.jsxs(s,{children:[a.jsx(v,{title:"Dokumen Perjalanan"}),a.jsxs(k,{className:"form-horizontal",children:[a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"no_paspor_ri_pemohon",title:"Nomor Paspor RI",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"wilayah_paspor_ri_pemohon",title:"Wilayah Paspor RI",readonly:!0,placeholder:"!"})})]}),a.jsx(r,{children:a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"tgl_exp_paspor_ri_pemohon",title:"Tanggal Exp Paspor RI",readonly:!0,placeholder:"!"})})}),a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"no_paspor_kebangsaan_pemohon",title:"Nomor Paspor Kebangsaan",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"wilayah_paspor_kebangsaan_pemohon",title:"Wilayah Paspor Kebangsaan",readonly:!0,placeholder:"!"})})]}),a.jsx(r,{children:a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"tgl_exp_paspor_kebangsaan_pemohon",title:"Tanggal Exp Paspor Kebangsaan",readonly:!0,placeholder:"!"})})})]})]})}),a.jsx(r,{children:a.jsxs(s,{children:[a.jsx(v,{title:"Data Alamat"}),a.jsxs(k,{className:"form-horizontal",children:[a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"id_provinsi_tinggal_pemohon",placeholder:"!",title:"Provinsi",readonly:!0})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"id_kab_kota_tinggal_pemohon",placeholder:"!",title:"Kabupaten/Kota",readonly:!0})})]}),a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"no_hp_pemohon",placeholder:"!",title:"Nomor HP",readonly:!0})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"email_pemohon",placeholder:"!",title:"Email",readonly:!0})})]}),a.jsx(s,{children:a.jsx(t,{formik:e,name:"alamat_tinggal_pemohon",placeholder:"!",title:"Alamat Rumah",readonly:!0})})]})]})})]}),Y={namaLengkapPemohon:"",kewarganegaraanAsal:"",tempatLahir:"",tanggalLahir:"",jenisKelamin:"",agama:"",pekerjaan:"",statusPerkawinan:"",tanggalPernikahan:"",nomorAktaNikah:"",nomorSkim:"",provinsi:"",kabupaten:"",kecamatan:"",kelurahan:"",rt:"",rw:"",kodePos:"",alamatRumah:"",nomorHp:"",email:"",namaLenkapPasangan:"",nikPasangan:"",nomorHpPasangan:"",emailPasangan:"",tempatLahirPasangan:"",tanggalLahirPasangan:"",pekerjaanPasangan:"",kewarganegaraanPasangan:"",jenisKelaminPasangan:"",agamaPasangan:""},J=({formik:e})=>a.jsxs(s,{children:[a.jsx(v,{title:"Informasi Data Pasangan"}),a.jsxs(k,{className:"form-horizontal",children:[a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"nama_lengkap_pasangan",placeholder:"Tulis nama lengkap",title:"Nama Lengkap",readonly:!0})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"no_hp_pasangan",title:"Nomor HP",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"email_pasangan",title:"Email",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"tgl_lahir_pasangan",title:"Tanggal Lahir",readonly:!0,placeholder:"!"})})]}),a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"agama_pasangan",title:"Agama",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"negara_lahir_pasangan_text",title:"Negara Lahir",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"6",children:a.jsx(t,{formik:e,name:"alamat_tinggal_pasangan",title:"Alamat Tinggal",readonly:!0,placeholder:"!"})})]}),a.jsx(r,{children:a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"status_kawin_pasangan",title:"Status Perkawinan",readonly:!0,placeholder:"!"})})}),a.jsx(v,{title:"Dokumen Perjalanan Pasangan"}),a.jsxs(r,{children:[a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"no_paspor_asing_pasangan",title:"Nomor Paspor Asing",readonly:!0,placeholder:"!"})}),a.jsx(s,{xs:"12",md:"12",lg:"6",xl:"3",children:a.jsx(t,{formik:e,name:"tgl_exp_paspor_asing_pasangan",title:"Tanggal Exp Paspor Asing",readonly:!0,placeholder:"!"})})]})]})]}),q={kutipanAktaLahirPemohon:{file_type:1,label:"Fotokopi kutipan akta kelahiran pemohon yang sudah diterjemahkan ke Bahasa Indonesia oleh penerjemah resmi dan dilegalisasi."},kutipanAktaPerkawinanAtauBukuNikah:{file_type:2,label:"Fotokopi kutipan akta perkawinan atau buku nikah yang sudah diterjemahkan ke Bahasa Indonesia dan dilegalisasi."},dokumenPernahWNI:{file_type:3,label:"Dokumen yang membuktikan bahwa pemohon pernah berstatus Warga Negara Indonesia."},ktpAtauNIT:{file_type:4,label:"Fotokopi KTP atau NIT (Nomor Induk Tetap) pemohon atau pasangan yang sudah dilegalisasi."},suratPernyataanPenolakanWNA:{file_type:5,label:"Surat pernyataan penolakan menjadi warga negara asing dari pemohon."},pasFoto:{file_type:6,label:"Pas foto terbaru berwarna ukuran sesuai ketentuan (misalnya 4x6 cm) dengan latar belakang merah atau biru."}},C={kutipanAktaLahirPemohon:{validField:"akta_lahir_pemohon_valid",catatanField:"catatan_akta_lahir_pemohon"},kutipanAktaPerkawinanAtauBukuNikah:{validField:"akta_kawin_pemohon_valid",catatanField:"catatan_akta_kawin_pemohon"},dokumenPernahWNI:{validField:"paspor_pemohon_valid",catatanField:"catatan_paspor_pemohon"},ktpAtauNIT:{validField:"ktp_pemohon_valid",catatanField:"catatan_ktp_pemohon"},suratPernyataanPenolakanWNA:{validField:"surat_menolak_wna_valid",catatanField:"catatan_surat_menolak_wna"},pasFoto:{validField:"pas_foto_valid",catatanField:"catatan_pas_foto"}},D=e=>{const n=C[e];return n?{validKey:n.validField,catatanKey:n.catatanField}:(console.warn(`No mapping found for fileKey: ${e}`),{validKey:`${e}_valid`,catatanKey:`catatan_${e}`})},Q=({label:e,data:n,fileKey:g,verifikasiData:i,onUpdate:u})=>{const{validKey:p,catatanKey:h}=D(g),c=()=>{n!=null&&n.url&&window.open(n.url,"_blank")},l=x=>{u(p,x)},o=x=>{u(h,x.target.value||null)},m=i[p],j=i[h];return a.jsxs("div",{className:"border rounded p-3 mb-3",children:[a.jsx("h6",{className:"mb-2",children:e}),a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col-md-6",children:[a.jsx("div",{className:"mb-3",children:a.jsx(y,{text:"Lihat Dokumen",bgColor:"transparent",textColor:"#041662",border:"1px solid #EfEfEf",onClick:c})}),a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{className:"form-label small text-muted",children:"Status Validasi:"}),a.jsxs("div",{className:"btn-group d-block",role:"group",children:[a.jsx("button",{type:"button",className:`btn btn-sm me-2 ${m===!0?"btn-success":"btn-outline-success"}`,onClick:()=>l(!0),style:{minWidth:"80px"},children:"✓ Sesuai"}),a.jsx("button",{type:"button",className:`btn btn-sm ${m===!1?"btn-danger":"btn-outline-danger"}`,onClick:()=>l(!1),style:{minWidth:"100px"},children:"✗ Tidak Sesuai"})]})]})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label small text-muted",children:"Catatan:"}),a.jsx("textarea",{className:"form-control",placeholder:"Tulis catatan...",rows:4,value:j||"",onChange:o})]})]})]})},X=({formik:e,onVerifikasiDataChange:n})=>{const g=e.values.files||[];console.log("FORMIK",e.values);const[i,u]=_.useState(()=>{const l={id_permohonan:e.values.id_permohonan||null};return Object.keys(C).forEach(o=>{const{validKey:m,catatanKey:j}=D(o);l[m]=null,l[j]=null}),l});_.useEffect(()=>{n&&n(i)},[i,n]);const p=Object.entries(q).reduce((l,[o,m])=>(l[m.file_type]={label:m.label,key:o},l),{}),h=Object.values(g.sort((l,o)=>new Date(o.uploaded_at)-new Date(l.uploaded_at)).reduce((l,o)=>(p[o.file_type]&&(l[o.file_type]||(l[o.file_type]=o)),l),{})),c=(l,o)=>{u(m=>({...m,[l]:o}))};return a.jsxs(F,{children:[h.length===0&&a.jsx("div",{className:"alert alert-info",children:"Tidak ada dokumen yang ditemukan untuk diverifikasi."}),h.map(l=>{const o=p[l.file_type];if(!o)return null;const{key:m,label:j}=o;return C[m]?a.jsx(Q,{data:l,label:j,fileKey:m,verifikasiData:i,onUpdate:c},l.id_file):(console.warn(`FileKey ${m} tidak ada di BACKEND_FIELD_MAPPING`),null)})]})};function Z(e,n=!0){const[g,i]=_.useState(!1),[u,p]=_.useState(null),[h,c]=_.useState(null);return _.useEffect(()=>{if(!n||!e)return;(async()=>{console.log("API RUN"),i(!0),p(null);try{const o=await H(e);c(o.data)}catch(o){p(o)}finally{i(!1)}})()},[e,n]),{data:h,loading:g,error:u}}const aa=e=>({id_permohonan:e.id_permohonan||"",nama_lengkap_pemohon:e.nama_lengkap_pemohon||"",nik_pemohon:e.nik_pemohon||"",id_provinsi_pemohon:e.id_provinsi_pemohon||"",id_kab_kota_pemohon:e.id_kab_kota_pemohon||"",id_negara_lahir_pemohon:e.negara_lahir_pemohon_text||"",tgl_lahir_pemohon:e.tgl_lahir_pemohon||"",jenis_kelamin_pemohon:e.jenis_kelamin_pemohon||"",status_kawin_pemohon:e.status_kawin_pemohon||"",id_kewarganegaraan_asal_pemohon:"Indonesia",id_pekerjaan_pemohon:e.pekerjaan_pemohon_text||"",tempat_tinggal_pemohon:e.tempat_tinggal_pemohon||"",id_negara_tinggal_pemohon:e.tempat_tinggal_pemohon==="Luar Negeri"?String(e.id_negara_tinggal_pemohon||""):"",id_provinsi_tinggal_pemohon:e.provinsi_pemohon_text,id_kab_kota_tinggal_pemohon:e.kab_kota_pemohon_text,alamat_tinggal_pemohon:e.alamat_tinggal_pemohon||"",no_hp_pemohon:e.no_hp_pemohon||"",no_telp_pemohon:e.no_telp_pemohon||"",email_pemohon:e.email_pemohon||"",no_akta_lahir_pemohon:e.no_akta_lahir_pemohon||"",tgl_akta_lahir_pemohon:e.tgl_akta_lahir_pemohon||"",no_akta_kawin_pemohon:e.no_akta_kawin_pemohon||"",tgl_akta_kawin_pemohon:e.tgl_akta_kawin_pemohon||"",no_paspor_ri_pemohon:e.no_paspor_ri_pemohon||"",wilayah_paspor_ri_pemohon:String(e.wilayah_paspor_ri_pemohon||""),tgl_exp_paspor_ri_pemohon:e.tgl_exp_paspor_ri_pemohon||"",no_paspor_kebangsaan_pemohon:e.no_paspor_kebangsaan_pemohon||"",wilayah_paspor_kebangsaan_pemohon:String(e.wilayah_paspor_kebangsaan_pemohon||""),tgl_exp_paspor_kebangsaan_pemohon:e.tgl_exp_paspor_kebangsaan_pemohon||"",nama_lengkap_pasangan:e.nama_lengkap_pasangan||"",alamat_tinggal_pasangan:e.alamat_tinggal_pasangan||"",email_pasangan:e.email_pasangan||"",negara_lahir_pasangan_text:e.negara_lahir_pasangan_text||"",no_hp_pasangan:e.no_hp_pasangan||"",tgl_lahir_pasangan:e.tgl_lahir_pasangan||"",alamat_tinggal_pasangan:e.alamat_tinggal_pasangan||"",status_kawin_pasangan:e.status_kawin_pasangan||"",agama_pasangan:e.agama_pasangan||"",no_paspor_asing_pasangan:e.no_paspor_asing_pasangan||"",tgl_exp_paspor_asing_pasangan:e.tgl_exp_paspor_asing_pasangan||"",status_aktivitas:e.status_aktivitas,files:e.files,status_aktivitas_text:e.status_aktivitas_text}),ea=e=>{let n;switch(e){case 0:n="Pembelian Voucher";break;case 1:n="Pendaftaran Permohonan";break;case 2:n="PBK";break;case 3:n="FU";break;case 4:n="Kasi";break;case 5:n="Kasubdit";break;case 6:n="Direktur";break;case 7:n="SK Terbit";break;default:n="Status tidak dikenali"}return n},ta=()=>{const e=W(),[n,g]=_.useState(0),[i,u]=_.useState(null),[p,h]=_.useState(!1),c=M(),l=new z,{data:o,loading:m,error:j}=Z(e.id);console.log("DATA DETAIL VERIFIKASI",o);const x=_.useMemo(()=>o?aa(o):Y,[o]),P=R({initialValues:x,enableReinitialize:!0,onSubmit:b=>{console.log("Submit values:",b),l.customWarningMsg("API Belum tersedia")}}),N=ea(x.status_aktivitas);console.log("STATUS AKTIVITAS",N),console.log("mappedValues",x);const T=_.useCallback(b=>{u(b)},[]),S=[a.jsx($,{formik:P}),a.jsx(J,{formik:P}),a.jsx(X,{formik:P,onVerifikasiDataChange:T})],K=()=>{n<S.length-1&&g(n+1)},E=()=>{n>0&&g(n-1)},V=()=>{c("/kewarganegaraan/daftar-verifikasi")},L=async()=>{if(!i){l.customErrorMsg("Data verifikasi belum tersedia");return}if(Object.entries(i).reduce((d,[f,w])=>(w!=null&&w!==""&&(d[f]=w),d),{}),console.log("Data verifikasi yang akan dikirim:",i),await l.confirmationCreate()){h(!0);try{const d=await I({...i,tipe_verifikator:N});console.log("API RESPONSE PATCH",d),d.message==="Success"&&(l.customSuccessMsg("Verifikasi berhasil disimpan"),setTimeout(()=>{c("/kewarganegaraan/daftar-verifikasi")},1500))}catch(d){console.error("Error submitting verifikasi:",d),l.customWarningMsg("Gagal menyimpan verifikasi")}finally{h(!1)}}},B=async()=>{if(await l.confirmationCustom("Apakah anda yakin untuk menolak permohonan","Isi alasan penolakan agar dapat disampaikan kepada pemohon.")){h(!0);try{console.log("Data penolakan:",i),(await I({...i,tipe_verifikator:N})).message==="Success"&&(l.customSuccessMsg("Verifikasi berhasil ditolak"),setTimeout(()=>{c("/kewarganegaraan/daftar-verifikasi")},1500))}catch(d){console.error("Error submitting verifikasi:",d),l.customWarningMsg("Gagal menyimpan verifikasi")}finally{h(!1)}}},A=_.useMemo(()=>i?!Object.keys(i).filter(f=>f.endsWith("_valid")).some(f=>i[f]===void 0||i[f]===null):!1,[i]);return a.jsxs(F,{className:"page-content bg-white mb-5",fluid:!0,children:[a.jsx("h3",{children:"Verifikasi Formulir Permohonan"}),a.jsxs("p",{className:"text-muted",children:["Tahapan ini merupakan proses verifikasi dokumen dan data permohonan penetapan Warga Negara Indonesia (WNI) yang dilakukan oleh verifikator tingkat ",a.jsx("strong",{children:N}),". Harap periksa keabsahan dan kelengkapan seluruh informasi yang disampaikan pemohon sebelum mengambil keputusan untuk menyetujui atau menolak permohonan."]}),m?a.jsx("p",{children:"Loading"}):a.jsx(k,{className:"rounded-3 border border-2 p-3",children:a.jsxs("form",{onSubmit:P.handleSubmit,children:[S[n],a.jsxs(k,{display:"flex",justifyContent:"flex-end",mt:4,children:[n===0&&a.jsx(y,{text:"Kembali",onClick:V,bgColor:"#e0e0e0",textColor:"#333",disabled:p}),n>0&&a.jsx(y,{text:"Kembali",onClick:E,disabled:n===0||p,bgColor:"#e0e0e0",textColor:"#333"}),n===S.length-1?a.jsxs(a.Fragment,{children:[a.jsx(y,{text:p?"Memproses...":"Tolak",type:"button",onClick:B,rightIcon:!p&&a.jsx(O,{fontSize:"small"}),bgColor:"#CF3533",hoverColor:"#BE1122",textColor:"#fff",disabled:p}),a.jsx(y,{text:p?"Memproses...":"Verifikasi",type:"button",onClick:L,rightIcon:!p&&a.jsx(U,{fontSize:"small"}),bgColor:A?"#1F7C4D":"#6c757d",hoverColor:A?"#1F6C4D":"#5a6268",textColor:"#fff",disabled:p,title:A?"":"Harap lengkapi verifikasi semua dokumen"})]}):a.jsx(y,{text:"Selanjutnya",type:"button",onClick:K,rightIcon:a.jsx(G,{}),bgColor:"#041662",textColor:"#fff",disabled:p})]})]})})]})};export{ta as default};
