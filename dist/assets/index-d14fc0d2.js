import{j as e,ax as G,ay as b,az as m,R as W,g as H,r as j,a as $,C as F,b as E,c as P,L as I,I as K,aw as T,aA as L,B as z,aF as q,aG as J,d as O,aH as Q,aC as V,aI as X,x as D,aJ as Y,aD as Z,aK as ee,aL as se,aM as ae,w as ne,T as oe}from"./index-cb7bfd5e.js";const te=[{id:"module_code",label:"Kode Modul",minWidth:170},{id:"module",label:"Nama Modul",minWidth:170},{id:"permission",label:"Hak Akses",minWidth:170}];function le(){return e.jsx(G,{children:e.jsx(b,{children:te.map(c=>e.jsx(m,{style:{backgroundColor:"#2A3042",color:"white"},align:"left",padding:c.disablePadding?"none":"normal",children:e.jsx(W.Fragment,{children:c.label})},c.id))})})}function re(c){var k,C,S;const{row:i,collapse:u,setCollapse:_,index:f,setClicked:h,setPermissionIndicator:v}=c,[N]=j.useState(window.innerWidth),y=N<=767?"10px":"12px",R=async()=>{const a=[...u];a[f]=!u[f],_(a)},p=async({event:a,item:n,type:s})=>{h(o=>{const t=o.find(r=>r.r_modules_code==n.r_modules_code&&r.code==n.code);return v({dataExist:t,module_code:n.r_modules_code}),t?o.map(r=>r.r_modules_code===n.r_modules_code&&r.code===n.code?{...r,[s]:a.target.checked?1:0}:r):[...o,{...n,[s]:a.target.checked?1:0}]})},M=(a,n)=>{const s=a.code.split(".").map(Number),o=n.code.split(".").map(Number);for(let t=0;t<Math.max(s.length,o.length);t++){const r=s[t]||0,g=o[t]||0;if(r!==g)return r-g}return 0},w=(k=i.menu)==null?void 0:k.sort(M);return e.jsxs(e.Fragment,{children:[e.jsxs(b,{onClick:()=>R(),children:[e.jsx(m,{sx:{width:80},children:(C=i==null?void 0:i.role)==null?void 0:C.module_code}),e.jsx(m,{sx:{width:120},children:((S=i==null?void 0:i.role)==null?void 0:S.module)||"-"}),e.jsx(m,{sx:{width:80},children:e.jsx("input",{type:"checkbox",style:{width:18,height:18},checked:i.access_permission,disabled:!0})})]}),e.jsx(b,{children:e.jsx(m,{className:"p-0",colSpan:8,children:e.jsx(q,{in:u[f],timeout:"auto",unmountOnExit:!0,children:e.jsx(J,{style:{marginLeft:"2rem"},className:"pe-0 bg-secondary bg-opacity-10",children:e.jsx(T,{children:e.jsx(L,{style:{backgroundColor:`rgba(${O("#F6E96B")}, 0.5)`},children:w==null?void 0:w.map((a,n)=>e.jsxs(b,{style:{cursor:"pointer"},className:"list-hover",hover:!0,tabIndex:-1,children:[e.jsx(m,{align:"left",sx:{paddingLeft:+a.level>1?+a.level<100?+a.level*3:(+a.level-99)*3:2,width:50},children:e.jsxs("svg",{"enable-background":"new 0 0 24 24",id:"Layer_1",version:"1.0",viewBox:"0 0 24 24","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"12",height:"12",children:[e.jsx("polygon",{points:"15,12 22,17 15,22 "}),e.jsx("path",{d:"M4,2v9c0,3.3,2.7,6,6,6h8",fill:"none",stroke:"#000000","stroke-miterlimit":"10","stroke-width":"4"})]})}),e.jsx(m,{align:"left",sx:{width:120},style:{fontSize:y},children:+a.level>100?e.jsxs("span",{children:[e.jsx("span",{className:"fw-bold",children:"Actions"})," - ",a==null?void 0:a.title]}):a.title}),e.jsx(m,{align:"left",style:{fontSize:y},sx:{width:80},children:e.jsx(Q,{defaultChecked:a.permission==1,onClick:s=>p({event:s,item:a,type:"permission"})})})]},n))})})})})})})]})}const ce=()=>{const{id:c}=H(),[i,u]=j.useState([]),[_,f]=j.useState(),[h,v]=j.useState([]),[N,y]=j.useState([]),R=$(),p=new oe,M=async a=>{var n;try{p.showLoading();const s=await V({r_roles_code:a}),o=((n=s.data[0])==null?void 0:n.role.role)||"";f(o);const t=await X();let r=[];for(let d of t.data){const l=await w({r_modules_code:d.code}),x={role:{module:d.title,module_code:d.code},menu:l};r.push(x)}const g=r.map(d=>{const l=s.data.find(x=>x.role.module_code==d.role.module_code);if(l){const x=d.menu.map(A=>{const B=l.menu.find(U=>U.menu_code===A.code);return B?{...A,...B}:A});return{role:l.role,menu:x,access_permission:!!l.menu.length}}return d});u(g)}catch(s){D(s)}finally{p.close()}},w=async a=>{try{return(await Y(a)).data}catch{return[]}};j.useEffect(()=>{M(c)},[c]);function k(a){const n=[];return a.forEach(s=>{if(s.menu&&Array.isArray(s.menu)){const o=s.menu.find(t=>t.permission=="1");o&&n.push(o)}}),n}const C=async()=>{if(!await p.confirmSubmit("Apakah anda yakin ingin mengubah data?"))return;p.loadingSendData();let n="";for(let s of h)if(s.id)if(s.permission==0)try{await Z({id:s.id.toString()})}catch(o){n=o}else{const o={id:s.id.toString(),permission:s.permission.toString()};try{await ee(o)}catch(t){n=t}}else{const o={r_roles_code:c.toString(),r_menus_code:s.code,r_modules_code:s.r_modules_code,permission:s.permission.toString()};try{await se(o)}catch(t){n=t}}try{const s=k(i),o=new Set;h.forEach(l=>{l.permission==0&&o.add(`${l.code}-${l.r_modules_code}`)});const t=s.filter(l=>{const x=`${l.code}-${l.r_modules_code}`;return!o.has(x)});console.log("filter ",t);const r=[...new Set(h.filter(l=>l.permission==1).map(l=>l.r_modules_code))],g=[...new Set([...t.map(l=>l.r_modules_code),...r])];console.log("res ",s,h);const d={code:c,title:_,r_modules_code:g.join(",")};await ae(d)}catch(s){n=s}p.close(),n?D({},"Gagal Update Data"):(ne("Berhasil Ubah Data"),R("/user-management/roles/list"))},S=({dataExist:a,module_code:n})=>{a&&a.permission==1?u(s=>h.filter(t=>t.r_modules_code==n&&t.permission==1).length==1?s.map(t=>t.role.module_code===n?{...t,access_permission:!1}:t):s):u(s=>s.map(o=>o.role.module_code===n?{...o,access_permission:!0}:o))};return e.jsxs(F,{fluid:!0,className:"page-content",children:[e.jsx(E,{children:e.jsx(P,{md:8,children:e.jsx("div",{className:"mb-3",children:e.jsxs("h1",{className:"text-primary fs-4 fw-bold text-uppercase m-0",children:["Detail Role - ",_]})})})}),e.jsxs("div",{className:"border rounded-4 bg-white p-3 mb-3",children:[e.jsx(E,{className:"mb-2",children:e.jsxs(P,{md:6,xl:4,children:[e.jsx(I,{className:"mb-0",children:"Nama Role"}),e.jsx(K,{type:"text",value:_,onChange:a=>f(a.target.value),placeholder:"Masukkan Nama Role"})]})}),e.jsxs(T,{children:[e.jsx(le,{}),e.jsx(L,{children:i.length?i.map((a,n)=>e.jsx(re,{row:a,collapse:N,setCollapse:y,index:n,setClicked:v,setPermissionIndicator:S},n)):e.jsx(b,{children:e.jsx(m,{colSpan:11,align:"center",children:"No data available"})})})]}),e.jsx(E,{className:"mb-2 mt-3 d-flex justify-content-end",children:e.jsx(P,{md:6,xl:4,className:"d-flex justify-content-end",children:e.jsx(z,{color:"primary",className:"px-5",onClick:C,children:"Simpan"})})})]})]})};export{ce as default};
