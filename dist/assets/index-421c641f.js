import{j as e,ax as P,ay as f,az as i,R as E,g as L,r as u,a as D,C as H,b as S,c as R,L as I,I as G,aw as T,aA as B,B as W,aF as F,aG as U,d as z,aH as q,aI as J,T as K,aJ as O,aN as $,aL as Q,x as M,w as V}from"./index-cb7bfd5e.js";import"./lodash-8ae51231.js";const X=[{id:"module_code",label:"Kode Modul",minWidth:170},{id:"module",label:"Nama Modul",minWidth:170},{id:"Akses",label:"Hak Akses",minWidth:170}];function Y(){return e.jsx(P,{children:e.jsx(f,{children:X.map(d=>e.jsx(i,{className:"bg-primary text-white",align:"left",padding:d.disablePadding?"none":"normal",children:e.jsx(E.Fragment,{children:d.label})},d.id))})})}function Z(d){var b,w,k;const{row:c,collapse:r,setCollapse:j,index:h,setClicked:y,setPermissionIndicator:C}=d,[_]=u.useState(window.innerWidth),g=_<=767?"10px":"12px",N=async()=>{const o=[...r];o[h]=!r[h],j(o)},p=({event:o,item:s,type:l})=>{y(n=>{const t=n.find(a=>a.r_modules_code===s.r_modules_code&&a.code===s.code);return C({dataExist:t,module_code:s.r_modules_code}),t?n.map(a=>a.r_modules_code===s.r_modules_code&&a.code===s.code?{...a,[l]:o.target.checked?1:0}:a):[...n,{...s,[l]:o.target.checked?1:0}]})},v=(o,s)=>{const l=o.code.split(".").map(Number),n=s.code.split(".").map(Number);for(let t=0;t<Math.max(l.length,n.length);t++){const a=l[t]||0,m=n[t]||0;if(a!==m)return a-m}return 0},x=(b=c.menu)==null?void 0:b.sort(v);return e.jsxs(e.Fragment,{children:[e.jsxs(f,{onClick:()=>{var o;return N((o=c==null?void 0:c.role)==null?void 0:o.module_code)},children:[e.jsx(i,{sx:{width:80},children:(w=c==null?void 0:c.role)==null?void 0:w.module_code}),e.jsx(i,{sx:{width:120},children:((k=c==null?void 0:c.role)==null?void 0:k.module)||"-"}),e.jsx(i,{sx:{width:80},children:e.jsx("input",{type:"checkbox",style:{width:18,height:18},checked:c.access_permission,disabled:!0})})]}),e.jsx(f,{children:e.jsx(i,{className:"p-0",colSpan:8,children:e.jsx(F,{in:r[h],timeout:"auto",unmountOnExit:!0,children:e.jsx(U,{style:{marginLeft:"2rem"},className:"pe-0 bg-secondary bg-opacity-10",children:e.jsx(T,{children:e.jsx(B,{style:{backgroundColor:`rgba(${z("#F6E96B")}, 0.5)`},children:x==null?void 0:x.map((o,s)=>e.jsxs(f,{style:{cursor:"pointer"},className:"list-hover",hover:!0,tabIndex:-1,children:[e.jsx(i,{align:"left",sx:{paddingLeft:+o.level>1?+o.level<100?+o.level*3:(+o.level-99)*3:2,width:50},children:e.jsxs("svg",{"enable-background":"new 0 0 24 24",id:"Layer_1",version:"1.0",viewBox:"0 0 24 24","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"12",height:"12",children:[e.jsx("polygon",{points:"15,12 22,17 15,22 "}),e.jsx("path",{d:"M4,2v9c0,3.3,2.7,6,6,6h8",fill:"none",stroke:"#000000","stroke-miterlimit":"10","stroke-width":"4"})]})}),e.jsx(i,{align:"left",sx:{width:120},style:{fontSize:g},children:+o.level>100?e.jsxs("span",{children:[e.jsx("span",{className:"fw-bold",children:"Actions"})," - ",o==null?void 0:o.title]}):o.title}),e.jsx(i,{align:"left",style:{fontSize:g},sx:{width:80},children:e.jsx(q,{defaultChecked:o.permission==1,onClick:l=>p({event:l,item:o,type:"permission"})})})]},s))})})})})})})]})}const ae=()=>{const{id:d}=L(),[c,r]=u.useState([]),[j,h]=u.useState(""),[y,C]=u.useState([]),[_,g]=u.useState([]),N=D(),p=new K,v=async()=>{const s=await J();r(s.data.map(l=>({role:{module:l.title,module_code:l.code}}))||[])},x=async s=>{const l=await O(s);r(n=>n.find(a=>a.role.module_code===s.r_modules_code)?n.map(a=>a.role.module_code===s.r_modules_code?{...a,menu:l.data.map(m=>({...m,permission:0}))}:a):[...n,{role:{module_code:s.r_modules_code},menu:l.data}])};u.useEffect(()=>{v()},[d]);const b=(s,l)=>{C(s);const n=c.find(t=>t.role.module_code==l.module_code);n!=null&&n.menu||x({r_modules_code:l.module_code})},w=async(s,l)=>{try{const n=await $(s);let t="";for(let a of l){const m={r_roles_code:n.data.roles_code,r_menus_code:a.code,r_modules_code:a.r_modules_code,permission:a.permission.toString()};try{await Q(m)}catch(A){t=A}}t?M({},"Terdapat Data Gagal Tersimpan, Harap cek kembali Data"):(V("Sukses Menyimpan Data"),N(-1))}catch(n){M(n)}finally{p.close()}},k=async()=>{if(!await p.confirmSubmit("Apakah anda yakin ingin menyimpan data?"))return;p.loadingSendData();const l=_.filter(a=>a.permission==1),n=[...new Set(l.map(a=>a.r_modules_code))],t={title:j,r_modules_code:n.join(",")};w(t,l)},o=({dataExist:s,module_code:l})=>{s&&s.permission==1?r(n=>_.filter(a=>a.r_modules_code==l&&a.permission==1).length==1?n.map(a=>a.role.module_code===l?{...a,access_permission:!1}:a):n):r(n=>n.map(t=>t.role.module_code===l?{...t,access_permission:!0}:t))};return e.jsxs(H,{fluid:!0,className:"page-content",children:[e.jsx(S,{children:e.jsx(R,{md:8,children:e.jsx("div",{className:"mb-3",children:e.jsx("h1",{className:"text-primary fs-4 fw-bold text-uppercase m-0",children:"Tambah Role"})})})}),e.jsxs("div",{className:"border rounded-4 bg-white p-3 mb-3",children:[e.jsx(S,{className:"mb-2",children:e.jsxs(R,{md:6,xl:4,children:[e.jsx(I,{className:"mb-0",children:"Nama Role"}),e.jsx(G,{type:"text",value:j,onChange:s=>h(s.target.value),placeholder:"Masukkan Nama Role"})]})}),e.jsxs(T,{children:[e.jsx(Y,{}),e.jsx(B,{children:c.length?c.map((s,l)=>e.jsx(Z,{row:s,collapse:y,setCollapse:n=>b(n,(s==null?void 0:s.role)||{}),index:l,setClicked:g,setPermissionIndicator:o},l)):e.jsx(f,{children:e.jsx(i,{colSpan:11,align:"center",children:"No data available"})})})]}),e.jsx(S,{className:"mb-2 mt-3 d-flex justify-content-end",children:e.jsx(R,{md:6,xl:4,className:"d-flex justify-content-end",children:e.jsx(W,{color:"primary",className:"px-5",onClick:k,children:"Simpan"})})})]})]})};export{ae as default};
